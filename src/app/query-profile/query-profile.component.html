<div *ngIf="isQueryDataAbsent" class="alert alert-warning w-75 mx-auto text-center wrap no-data-message" role="alert">
  There is no any data from this host for this period. Maybe monitoring wasn't available at this moment. Please select
  wider period of time or wait for several minutes to collect some data
</div>
<div *ngIf="isNotExistSelected" class="alert alert-warning w-75 mx-auto text-center wrap invalid-name-message" role="alert">
  Host name is not valid, please click the Host dropdown and select a valid host. If the Host list is empty, use
  <code>pmm-admin add</code> to add a monitoring service and check again. For more information on how to add a
  monitoring service,
  consult
  <a href="https://www.percona.com/doc/percona-monitoring-and-management/pmm-admin.html#adding-monitoring-services"
     target="blank">PMM documentation.</a>
</div>
<div *ngIf="dbServer !== null && dbServer !== undefined" class="content-wrapper">
  <div *ngIf="!noQueryError" class="queries-viewer">
    <section class="configuration-panel">
      <p class="configuration-panel__title">
        Top {{ totalAmountOfQueries ? (queryProfile?.length - 1) : 0 }} of {{ totalAmountOfQueries }} Queries by % Grand Total Time (%GTT)
      </p>

      <div class="configuration-panel__options center-children">
        <span>Display</span>
        <label class="switcher">
          <input type="checkbox"
                 class="switcher__checkbox"
                 (change)="isFirstSeenChecked = !isFirstSeenChecked; getFirstSeen(isFirstSeenChecked);"
                 [disabled]="!isQuerySwitching && !isLoading && totalAmountOfQueries === 0 && !isFirstSeenChecked && !isSearchQuery">
          <span class="switcher__slider">
  	        <span class="switcher__option">All queries</span>
            <span class="switcher__option">First seen</span>
          </span>
        </label>
      </div>

      <form (submit)="search()" class="query-search query-search--clicked">
        <input [(ngModel)]="searchValue" name="searchValue"
               [disabled]="!isQuerySwitching && !isLoading && totalAmountOfQueries === 0 && !isSearchQuery"
               class="input-field query-search__input"
               type="text" placeholder="Search by query abstract, fingerprint or ID"
               id="search-input">
        <button class="query-search__button" type="submit">
          <span class="fa fa-search"></span>
        </button>
      </form>
    </section>

    <section class="configuration-panel">
      <ng-select [(ngModel)]="selected"
                 [items]="configs"
                 (change)="checkEmptyColumn(selected)"
                 class="pmm-select"
                 bindLabel="name"
                 role="combobox">
      </ng-select>

      <app-qan-edit-column></app-qan-edit-column>
    </section>

    <!--<section *ngIf="!isQuerySwitching" class="grid-table queries-viewer__table" id="qanTable">-->
    <!--<div *ngFor="let row of queryProfile; let i = index; let first = first;"-->
    <!--[routerLink]="['./', 'report', dbServer.Subsystem]"-->
    <!--[queryParams]="composeQueryParamsForGrid(row.Id)" routerLinkActive="grid-table__row&#45;&#45;active"-->
    <!--[class.grid-table__row&#45;&#45;load]="isLoad"-->
    <!--[class.grid-table__row&#45;&#45;count]="isCount"-->
    <!--[class.grid-table__row&#45;&#45;latency]="isLatency"-->
    <!--[class.grid-table__row&#45;&#45;first-seen]="checkFirstSeen(row)"-->
    <!--class="grid-table__row grid-table__row&#45;&#45;main grid-table__row&#45;&#45;cursor">-->
    <!--<span *ngIf="first" class="table-border-bottom">#</span>-->
    <!--<span *ngIf="first" class="table-border-bottom">Query Abstract</span>-->
    <!--<div *ngIf="!!selected && first" class="table-border-bottom"-->
    <!--id="sparklineColumn">{{ selected.name }}</div>-->
    <!--<div *ngIf="!!selected && first" class="table-border-bottom" id="rowsScannedColumn">Rows Scanned</div>-->
    <!--<span *ngIf="first" class="schemas-column table-border-bottom">Schemas</span>-->

    <!--<span>{{ i || '' }}</span>-->
    <!--<div class="overlay-container">-->
    <!--<a href="javascript:;" class="row__link overlay-container__item" title="{{ row.Fingerprint }}" id="fingerprint">-->
    <!--{{ row.Rank ? (row.Abstract || 'Low Ranking Queries') : 'TOTAL' }}-->
    <!--</a>-->
    <!--</div>-->

    <!--&lt;!&ndash;Load&ndash;&gt;-->
    <!--<div *ngIf="isLoad" class="column-sparkline" id="loadSparklineColumn">-->
    <!--<div class="scaling-svg-container app-tooltip"-->
    <!--[appLoadSparklines]="row.Log"-->
    <!--data-tooltip="Loading..."-->
    <!--xkey="Start_ts" ykey="Query_load"-->
    <!--measurement="number"-->
    <!--id="loadSparkline">-->
    <!--</div>-->
    <!--<span id="loadValue">-->
    <!--{{ row.Load | humanize : 'number' }}-->
    <!--</span>-->
    <!--</div>-->
    <!--<div *ngIf="isLoad" class="column-rows-scanned" id="loadRowsScannedColumn">-->
    <!--<span id="loadPercentage">-->
    <!--{{ row.Percentage | humanize : 'percent' }}-->
    <!--</span>-->
    <!--</div>-->
    <!--&lt;!&ndash;end of Load&ndash;&gt;-->

    <!--&lt;!&ndash;Count&ndash;&gt;-->
    <!--<div *ngIf="isCount" class="column-sparkline" id="countSparklineColumn">-->
    <!--<div-->
    <!--class="scaling-svg-container app-tooltip"-->
    <!--[appLoadSparklines]="row.Log"-->
    <!--data-tooltip="Loading..."-->
    <!--xkey="Start_ts" ykey="Query_count"-->
    <!--measurement="number"-->
    <!--id="countSparkline">-->
    <!--</div>-->
    <!--<span class="unit unit&#45;&#45;qps" id="countQueriesPerSecond">-->
    <!--{{row.QPS | humanize : 'number'}}-->
    <!--</span>-->
    <!--</div>-->
    <!--<div *ngIf="isCount" class="column-rows-scanned" id="countRowsScannedColumn">-->
    <!--<span *ngIf="selected?.value" id="countValue">-->
    <!--{{row.Stats.Cnt | humanize : 'number'}}-->
    <!--</span>-->
    <!--<span class="unit unit&#45;&#45;percent" id="countPercentage">-->
    <!--{{ (row.Stats.Cnt / profileTotal?.Stats.Cnt * 100).toFixed(2) }}-->
    <!--</span>-->
    <!--</div>-->
    <!--&lt;!&ndash;end of Count&ndash;&gt;-->

    <!--&lt;!&ndash;Avg Latency&ndash;&gt;-->
    <!--<div *ngIf="isLatency" class="column-sparkline" id="latencySparklineColumn">-->
    <!--<div-->
    <!--class="scaling-svg-container app-tooltip"-->
    <!--[appLoadSparklines]="row.Log"-->
    <!--data-tooltip="Loading..."-->
    <!--xkey="Start_ts" ykey="Query_time_avg"-->
    <!--measurement="time"-->
    <!--id="latencySparkline">-->
    <!--</div>-->
    <!--<span id="latencyValue">-->
    <!--{{ row.Stats.Avg | humanize }}-->
    <!--</span>-->
    <!--</div>-->
    <!--<div *ngIf="isLatency" class="column-rows-scanned" id="latencyRowsScannedColumn">-->
    <!--<div-->
    <!--class="scaling-svg-container scaling-svg-container&#45;&#45;full-width app-tooltip"-->
    <!--data-tooltip="Loading..."-->
    <!--measurement="time"-->
    <!--[appLatencyChart]="row.Stats"-->
    <!--id="latencyDistribution">-->
    <!--</div>-->
    <!--</div>-->
    <!--&lt;!&ndash;end of Avg Latency&ndash;&gt;-->
    <!--<div class="schemas-column" id="schemas">&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;</div>-->
    <!--</div>-->
    <!--</section>-->

    <table *ngIf="!isQuerySwitching" class="pmm-grid-table">
      <tr class="pmm-grid-table__row">
        <th class="pmm-grid-table__cell">#</th>
        <th class="pmm-grid-table__cell pmm-grid-table__cell--full">Query Abstract</th>
        <th class="pmm-grid-table__cell">{{selected.name}}</th>
        <th class="pmm-grid-table__cell">Rows Scanned</th>
      </tr>
      <tr *ngFor="let row of queryProfile; let i = index;"
          [routerLink]="['./', 'report', dbServer.Subsystem]"
          [queryParams]="composeQueryParamsForGrid(row.Id)" routerLinkActive="pmm-grid-table__row--active"
          [class.pmm-grid-table__row--first-seen]="checkFirstSeen(row)"
          class="pmm-grid-table__row">
        <td class="pmm-grid-table__cell">
          {{i || ''}}
        </td>
        <td class="pmm-grid-table__cell">
          <div>
            <button class="pmm-grid-table__details-button">
              {{ row.Rank ? (row.Abstract || 'Low Ranking Queries') : 'TOTAL' }}
            </button>
          </div>
        </td>
        <td class="pmm-grid-table__cell">
          <table class="pmm-grid-table__sub-table">
            <tr class="sub-table__row">
              <td class="sub-table__cell">
                <div class="scaling-svg-container app-tooltip"
                     [appLoadSparklines]="row.Log"
                     data-tooltip="Loading..."
                     xkey="Start_ts" ykey="Query_load"
                     measurement="number"
                     id="loadSparkline">
                </div>
              </td>
              <td class="sub-table__cell">
                <span id="loadValue">
                  {{ row.Load | humanize : 'number' }}
                </span>
              </td>
            </tr>
          </table>
        </td>
        <td class="pmm-grid-table__cell">
          <table class="pmm-grid-table__sub-table">
            <tr class="sub-table__row">
              <td class="sub-table__cell">
                <div
                  class="scaling-svg-container scaling-svg-container--full-width app-tooltip"
                  data-tooltip="Loading..."
                  measurement="time"
                  [appLatencyChart]="row.Stats"
                  id="latencyDistribution">
                </div>
              </td>
              <td class="sub-table__cell"></td>
            </tr>
          </table>
        </td>
      </tr>
    </table>

    <div class="center-children">
      <button *ngIf="totalAmountOfQueries && !isLoading"
              (click)="loadMoreQueries()"
              [disabled]="leftInDbQueries === 0"
              class="button button--dark button--big">
        {{quantityDbQueriesMessage}}
      </button>
      <div *ngIf="isLoading || isQuerySwitching" class="spinner-wrapper">
        <i class="fa fa-spinner fa-pulse fa-fw fa-40"></i>
      </div>
    </div>
  </div>

  <router-outlet></router-outlet>

  <div *ngIf="!!noQueryError" class="text-center alert alert-danger w-75 mx-auto wrong-configuration-message" role="alert">
    {{ noQueryError }}
  </div>

  <div *ngIf="!isQuerySwitching && !isLoading && totalAmountOfQueries === 0" class="text-center">
    <div *ngIf="dbServer.Subsystem === 'mongo' && !isFirstSeenChecked && !isSearchQuery"
         class="alert alert-warning w-75 mx-auto wrap no-mongo-queries">
      There is no query data because profiling is not enabled for the selected host. For information about how to
      enable profiling, see
      <a href="https://www.percona.com/doc/percona-monitoring-and-management/conf-mongodb.html" target="blank">
        Configuring profiling in MongoDB
      </a>in PMM documentation.
    </div>
    <div *ngIf="dbServer.Subsystem === 'mysql' && !isFirstSeenChecked && !isSearchQuery"
         class="alert alert-warning w-75 mx-auto wrap no-mysql-queries">
      There is no query data because the MySQL Server is not configured for monitoring. For details about the
      required configuration, see
      <a href="https://www.percona.com/doc/percona-monitoring-and-management/conf-mysql.html" target="blank">
        Configuring MySQL for Percona Monitoring and Management
      </a>in PMM documentation.
    </div>
    <div *ngIf="isFirstSeenChecked && !isSearchQuery" class="alert alert-warning w-75 mx-auto wrap">
      There are no queries First Seen during the selected time range, try widening your time range.
    </div>
    <div *ngIf="isSearchQuery" class="alert alert-warning w-75 mx-auto wrap">
      There are no queries during the selected time range, try widening your time range.
    </div>
  </div>
</div>
